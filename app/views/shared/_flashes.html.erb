<% invisible_flash_keys = [/^mp_track/, /_allow_raw$/, /_flag$/, /previous_/] %>

<% if consolidated_flash.any? %>
  <div id="flash">
    <% consolidated_flash.each do |key, value| -%>
      <% next if invisible_flash_keys.any?{|regex| key.to_s =~ regex} %>
      <div id="flash_<%= key %>">
        <div class="row">
          <div class="flash-content large-12 columns">
            <% bracketless = value.flatten.compact.map{|value_part| value_part.gsub('["', '').gsub('"]', '')} %>
            <% result = if raw_allowed_in_flash?(key) %>
              <% bracketless.length == 1 ? bracketless.first : bracketless %>
            <% else %>
              <% bracketless = bracketless.map{|value_part| "<p>" + h(value_part) + "</p>"}.join %>
              <% bracketless.gsub! "support@air.bo", link_to("support@air.bo", "mailto:support@air.bo") %>
              <% bracketless %>
            <% end %>
            <%= raw result %>
          </div>
          <div class="flash-close">
            <a href="#" id="close-flash">x</a>
          </div>
        </div>
      </div>
    <% end -%>
  </div>
<% end %>

<script type="text/javascript">
$('#close-flash').click(function() {
    $('#flash').slideUp();
  });

  function deleteCookie(name) {
    // Note the path is set to root so that it will clear cookies set from more specific paths
    document.cookie = name + '=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/';
  } 
</script>
