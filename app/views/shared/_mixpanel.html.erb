<!-- start Mixpanel --><script type="text/javascript">var mpq=[];mpq.push(["init","<%= MIXPANEL_TOKEN %>"]);(function(){var b,a,e,d,c;b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=(document.location.protocol==="https:"?"https:":"http:")+"//api.mixpanel.com/site_media/js/api/mixpanel.js";a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a);e=function(f){return function(){mpq.push([f].concat(Array.prototype.slice.call(arguments,0)))}};d=["init","track","track_links","track_forms","register","register_once","identify","name_tag","set_config"];for(c=0;c<d.length;c++){mpq[d[c]]=e(d[c])}})();
</script><!-- end Mixpanel -->

<% if current_user.present? %>
  <%= javascript_tag do %>
    mpq.identify('<%= current_user.email %>');
    mpq.name_tag('<%= current_user.name %>');
  <% end %>
<% end %>
<% flash.select{|k,v| k.to_s =~ /^mp_track/}.each do |k, v| %>
  <% event, properties = v %>
  <%= mp_track event, properties %>
<% end %>
