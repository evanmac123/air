<header>
  <div class="row" id="top_bar">

    <% _activity_path = current_user.is_guest? ? public_activity_path(current_user.demo.public_slug) : activity_path %>
    <div class="large-2 columns" id="logo">
      <a href="<%= _activity_path %>"><%= image_tag skinned('logo_url', "logo.png") %></a>
    </div>

    <%# If we don't need the guest user controls, steal their space for the 
    navigation, so we can use it for the current board. %>
    <% unless current_user.is_guest? %>
      <nav id="navigation" class="columns large-5"> <!-- offcanvas menu -->
        <div class="user_options">
          <ul>
            <li><%= link_to "Home", _activity_path, :class => 'nav-home' %></li>
            <li><%= link_to "My Profile", user_path(current_user), :id => 'my_profile', :class => 'nav-activity-class' %></li>
            <li><%= link_to "Find users", users_path, :class => 'nav-directory' %></li>
            <li><%= link_to "Settings", edit_account_settings_path, :class => 'nav-settings' %></li>
            <% if current_user.authorized_to?(:site_admin) %>
              <li><%= link_to "Site admin", admin_path, :class => 'nav-admin', id: 'nav-site-admin-link' %></li>
            <% end %>
            <li><%= link_to "Sign Out", sign_out_path, :method => :delete , :class => 'nav-signout' %></li>

            <%# Mobile-only select version of the board switcher %>
            <% if @boards_to_switch_to.present? && @boards_to_switch_to.length > 1 %>
              <li class="board_switch_dropdown">
                <select>
                  <%= options_from_collection_for_select @boards_to_switch_to, :id, :name, current_user.demo_id %>
                </select>
              </li>
              <%= content_for :javascript do %>
                <%= javascript_tag do %>
                  $('.board_switch_dropdown select').live('change', function(event) {
                    selectedOption = $(event.target).find('option:selected');
                    boardId = selectedOption.val();
                    $('#board-switch-link-' + boardId).click();
                  });
                <% end %>
              <% end %>
            <% end %>

          </ul>
        </div>
        <div id="board_switch">
          <a id="board_switch_toggler">
            <p class="small_cap">Current board</p>
            <p class="board_name has-tip tip-left" data-tooltip title="Switch between boards">
              <%= truncate(current_user.demo.name, length: 18) %>
              <span class="fa fa-caret-down"></span>
            </p>
          </a>
        </div>
          <%# Desktop version of the board switcher %>
          <ul class="other_boards">
            <% if @boards_to_switch_to.present? && @boards_to_switch_to.length > 1 %>
              <% @boards_to_switch_to.each do |board| %>
                <%# In this version, we don't display the current board. %>
                <% next if board == current_user.demo %>
                <li><%= link_to board.name, current_board_path(board_id: board.id), method: :put, id: "board-switch-link-#{board.id}" %></li>
              <% end %>
            <% else %>
              <li><span id="no_other_boards">You haven't joined any other boards.</span></li>
            <% end %>
          </ul>
        <div class="admin_options">
          <% if current_user.authorized_to?(:client_admin) %>
            <p class="small_cap">Board tools</p>
            <%= link_to fa_icon('gear'), '#', id: 'explore_board' %>
            <%= link_to explore_path, id: 'explore_board' do %>
              <span class="fa fa-rocket"></span>
              <span>Explore</span>
            <% end %>
            <%= link_to 'Manage', client_admin_tiles_path, id: 'manage_board' %>
            <a id="admin_toggle">&#9662;</a>
            <ul class="client_admin_pages">
              <% if current_user.has_balances? %>
                <li><%= link_to "Payments", new_client_admin_payment_path %></li>
              <% end %>
              <li><%= link_to "Admin help", DeskSSO.new(current_user).url, target: "_blank" %></li>
            </ul>
          <% end %>
        </div>
      </nav> <!-- end of off canvas -->
    <% end %>

    <% if current_user.is_guest? %>
      <% guest_user_header_button_style = show_save_progress_button ? '' : 'display: none' %>
      <div id="save_progress" class="large-4 columns" style="<%= guest_user_header_button_style %>">
        <a href="#" id="save_progress_button" class="open_save_progress_form">Save Progress</a>
        <%= link_to "Sign In", new_session_path, id: 'sign_in_button' %>
        <% if session[:display_start_over_button] %>
          <%= link_to "Start Over", guest_user_reset_path, id: 'guest_user_start_over_button', confirm: "Are you sure?", method: :put %>      
        <%else%>
          <%= link_to "Start Over", guest_user_reset_path, id: 'guest_user_start_over_button', style: 'display:none', confirm: "Are you sure?", method: :put %>
        <% end %>
      </div>
    <% end %>

<!-- start of new admin navigation that needs to be gated off later -->
    <div class="large-5 columns" id="user_info">
      <ul id="total_tiles" class="user_info_sections">
        <li><p class="small_cap">Experience</p></li>
        <li><p class="user_numbers">
          <span id="user_points"><%= number_with_delimiter starting_points %></span>
        </p></li>
      </ul>
      <ul id="to_next_credit" class="user_info_sections">
        <li><p class="small_cap">To next ticket</p></li>
        <li id="progress_bar">
        <div id="completed_progress" style="<%= master_bar_starting_width %>"></div>
          <span class="small_cap"><%= master_bar_point_content %></span>
        </li>
      </ul>
      <ul id="credits" class="user_info_sections">
        <li><p class="small_cap">Tickets</p></li>
        <li><p class="user_numbers" id="user_tickets"><%= starting_tickets %></p></li>
      </ul>

      <div id="me_toggle">
        <div class="shadow_overlay"></div>
        <%= default_avatar_tag current_user, :id => :top_avatar, :class => "avatar48" %>
      </div>
    </div>
      
  </div> <!-- end of topbar -->

  <div id="small-toggle" class="off-canvas-toggle"><a href="#side-nav" class="small_cap">MENU</a></div>

</header>
