<% after ||= "" %>
<% mixpanel_event_name ||= "" %>

<% content_for :javascript do %>
  <%= javascript_tag do %>
    var <%= offset_var_name %> = <%= current_offset %>;
    var <%= path_var_name %> = '<%= original_path %>';

    $('<%= button_selector %>').bind('click', function(e) {
      <% if mixpanel_event_name.present? %>
        mixpanel.track('<%= mixpanel_event_name %>', {offset: <%= offset_var_name %>});
      <% end %>

      $('<%= spinner_selector %>').show();
      $.get(<%= path_var_name %>, {offset: <%= offset_var_name %>}, function(){<%= after %>});
      e.preventDefault();
    });
  <% end %>
<% end %>
