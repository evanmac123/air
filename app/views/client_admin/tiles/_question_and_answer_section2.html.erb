<div class="tile_texts_container">
  <div class="tile_quiz">
    <div class="tile_types">
      <ul class="button-group">
        <% tile_types.each do |type, subtypes| %>
          <li class="tile_type">
            <a id="<%= type %>" href="#" data-dropdown="drop_<%= type %>" class="button has-tip" data-tooltip title="<%= tile_type_tooltips[type] %>"><%= type %> <i class="fa fa-caret-down"></i></a>

            <ul id="drop_<%= type %>" class="f-dropdown">
              <% subtypes.each do |key, subtype| %>
                <li id="<%= type + '-' + key %>" class="subtype" ><%= subtype[:name] %></li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>      
    </div>
    <div class="quiz_content">
      <p class="placeholder">Pick what users will earn points for.</p>
    </div>
  </div>
</div>
<% content_for :javascript do %>
  <%= javascript_tag do %>
    window.tile_types = <%= raw(tile_types.to_json) %>;
    function getTileType(str){
      return str.match(/(.*)-/)[1];
    };
    function getTileSubtype(str){
      return str.match(/-(.*)/)[1];
    };
    function addAnswers(container, answers) {
      answers_group = $('<div class="multiple_choice_group"></div>');
      container.append(answers_group);
      for(i in answers) {
        answers_group.append( '<div class="tile_multiple_choice_answer">' +  
                          '<a>' + answers[i] + '</a></div>');
      }
    };
    function addQuestion(container, question) {
      container.append('<div class="tile_question">' + question + '</div>');
    };
    function showQuestionAndAnswers(subtype) {
      $(".quiz_content").html("");
      quiz_content = $(".quiz_content");
      addQuestion(quiz_content, subtype["question"]);
      addAnswers(quiz_content, subtype["answers"]);
    };
    function makeButtonsSelected(type, subtype) {
      $("#" + type).click();

      $(".button.selected").removeClass("selected");
      $(".subtype.selected").removeClass("selected");

      $("#" + type).addClass("selected");
      $("#" + subtype).addClass("selected");
    };
    $(".subtype").click(function selectSubtype(){
      type = getTileType($(this).attr("id"));
      subtype = getTileSubtype($(this).attr("id"));

      makeButtonsSelected(type, $(this).attr("id"));
      showQuestionAndAnswers(tile_types[type][subtype]);
    });
  <% end %>
<% end %>
