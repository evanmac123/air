<div class="tile_texts_container">
  <div class="tile_quiz">
    <div class="tile_types">
      <ul class="button-group">
        <% tile_types.each do |type, subtypes| %>
          <li class="tile_type">
            <a id="<%= type %>" href="#" data-dropdown="drop_<%= type %>" class="button"><%= type %> <i class="fa fa-caret-down"></i></a>

            <ul id="drop_<%= type %>" class="f-dropdown">
              <% subtypes.each do |key, subtype| %>
                <li id="<%= type + '-' + key %>" class="subtype" ><%= subtype[:name] %></li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>      
    </div>
    <div class="quiz_content">
      <p class="placeholder">Pick what users will earn points for.</p>
    </div>
  </div>
</div>
<% content_for :javascript do %>
  <%= javascript_tag do %>
    window.tile_types = <%= raw(tile_types.to_json) %>;

    function turnRadioGreen() {
      $('.option_radio').unbind();
      $('.option_radio').click(function() {
        var radioButton = $(this).find('input:radio');
        if($(this).hasClass('option_selected')){
          $('.option_radio').removeClass('option_selected');  
          radioButton.prop('checked', false);
        }else {
          $('.option_radio').removeClass('option_selected');  
          radioButton.attr('checked','true');
          $(this).addClass('option_selected');
        } 
        markRightAnswer(this);
      });
    };

    addCharacterCounterFor('#tile_builder_form_headline');
    addCharacterCounterFor('#tile_builder_form_supporting_content');
    _.each($('.answer-field'), addCharacterCounterFor);
    turnRadioGreen();

    $(".subtype").click(function selectSubtype(){
      type = getTileType($(this).attr("id"));
      subtype = getTileSubtype($(this).attr("id"));

      makeButtonsSelected(type, $(this).attr("id"));
      showQuestionAndAnswers(tile_types[type][subtype]);
      showSelectAndAddAnswer();

      _.each($('.answer-field'), addCharacterCounterFor);
      turnRadioGreen();
      selectMessage();
      rebindEvents();
    });

    function rebindEvents() {
      $("#tile_builder_form_question").bind('input propertychange', function() {
        saveQuestionChanges(this);
      });

      $(".answer-field.answer-part").bind('input propertychange', function() {
        saveAnswerChanges(this);
      });

      $('body').unbind();
      $('body').click(function(event) {
        if (!$(event.target).is(".tile_question") && !$(event.target).is("#tile_builder_form_question")) {
          turnOffEditQuestion();
        };
        tryTurnOffEditAnswer(event.target);
      });

      $(".tile_question").click(function() {
        turnOnEditQuestion(this);
      });

      $(".tile_multiple_choice_answer a").click(function() {
        turnOnEditAnswer(this);
      });

      var initialAnswerField = $('.answer_option').eq(0);

      $('.add_answer').click(function(e) {
        addNewAnswer();
      });
    };
  <% end %>
<% end %>
