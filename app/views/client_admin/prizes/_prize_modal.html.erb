<div id="prize_modal" class="reveal-modal" data-reveal>
     <%= render partial: "client_admin/prizes/prize", locals: {raffle: raffle, entries: starting_tickets} %>
</div>
<a href="#" id="modal_link" data-reveal-id="prize_modal" data-animation="fadeAndPop" data-animationspeed="300" data-closeonbackgroundclick="true" data-dismissmodalclass="close_modal">Click for a modal</a>
<% content_for :javascript do %>
  <%= javascript_tag do %>
    $().ready(function(){
    <% if raffle.show_finish? current_user %>
        $(".prize_header .end_date").css("display", "none");
        $(".prize_header").css("text-align", "center");
        showRaffleBox("Prize Period Finished!");
        prizeModalPing("Saw Prize Modal");
      <% elsif raffle.show_start? current_user %>
        if( $("#get_started_lightbox").length == 0 && $('#activity-joyride').length == 0 ){ 
        // not display prize and get started box simultaneously
          showRaffleBox("New Raffle!");
          prizeModalPing("Saw Prize Modal");
        }else{
          window.showRaffleAfterLightbox = true;
        }
      <% end %>
    });
    $(".close_modal").click(function(){
      mq = window.matchMedia( "(min-width: 500px)" );
      if (mq.matches || window.oldBrowser) {
        $('[data-reveal]').foundation('reveal','close');
        }else{
          hideRaffleMobile();
        }
    });
    $("#raffle_data").click(function(){
      showRaffleBox("Prize");
      prizeModalPing("Clicked Prize Info");
    });
    function prizeModalPing(event){
      $.ajax({
        type: "POST",
        url: "/ping",
        data: { event: event, properties: { action: "Clicked Start", public_slug: "<%= params[:public_slug] %>"} }
      });
    }
    function showRaffleBox(header){
      $(".prize_header h1").text(header);
      mq = window.matchMedia( "(min-width: 500px)" );
      if (mq.matches || window.oldBrowser) {
        // window width is at least 500px
        $("#modal_link").click();
      }
      else {
        // window width is less than 500px
        showRaffleMobile();
      }
    }
    function showRaffleMobile(){
      $("#prize_modal").removeClass("reveal-modal");
      $(".content").children().slice(3).css("display", "none");
      $("footer").css("display", "none");
      $("body").css("background", "white");
      $(".jPanelMenu-panel").css("background", "white");
    }
    function hideRaffleMobile(){
      $("#prize_modal").addClass("reveal-modal");
      $(".content").children().slice(3).css("display", "block");
      $("footer").css("display", "block");
      $("jPanelMenu-panel").css("background", "");
      $(".content").css("background", "");
    }
  <% end %>
<% end %>
