<% content_for :navbar do %> 
  <span id="buttons">
    <% %w(process engage track video blog contact).each do |link_title| %>
      <%= link_to link_title.capitalize, "#" + link_title %>
    <% end %>
  </span>
<% end %>

<div id="upper-box">
  <div class="marketing-content">
    <%= image_tag 'new_marketing/logo.png', :alt => 'H Engage logo', :id => 'logo' %>
    <%= image_tag 'new_marketing/img_spark_engagement.png', :alt => 'Spark engagement in health and wellness using the technology people love', :id => 'spark-engagement' %>
    <%= image_tag 'new_marketing/img_phones_scoring.png', :alt => 'Get healthy, +10 points. Eat right, +5 points. Play H Engage, +25 points.', :id => 'phones-scoring' %>
    <%= image_tag 'new_marketing/img_green_arrow.png', :id => 'green-arrow' %>
  </div>
</div>

<div id="factoids">
  <div class="marketing-content">
    <%= image_tag "new_marketing/drop_media.png", :class => 'factoid' %>
    <%= image_tag "new_marketing/drop_games.png", :class => 'factoid' %>
    <%= image_tag "new_marketing/drop_text.png", :class => 'factoid' %>
  </div>
</div>

<div id="postits">
  <% %w(process engage track roi).each do |postit_name| %>
    <% original_path = "new_marketing/img_h_#{postit_name}1.png" %>
    <% hover_path = "new_marketing/img_h_#{postit_name}2.png" %>
    <% image_id = "postit-#{postit_name}" %>

    <%= link_to image_tag(original_path, :id => image_id), "##{postit_name}" %>
    <%= image_tag hover_path, :style => "display: none" %>

    <%= javascript_tag do %>
      $(document).ready(function(e) {
        makePostitJiggle('<%= image_id %>', '/images/' + '<%= original_path %>', '/images/' + '<%= hover_path %>');
      });
    <% end %>
  <% end %>

  <div id="postit-text">
    <span class="word-equation-term"><a href="#process" id="link-process">Play</a></span>
    <span class="word-equation-term">+</span>
    <span class="word-equation-term"><a href="#engage" id="link-engage">Engage</a></span>
    <span class="word-equation-term">+</span>
    <span class="word-equation-term"><a href="#track" id="link-track">Track</a></span>
    <span class="word-equation-term">=</span>
    <span class="word-equation-term last"><a href="#roi" id="link-roi">ROI</a></span>
  </div>
</div>

<div id="double-column">
  <a name="process"></a>

  <div class="main-section">
    <%= image_tag 'new_marketing/h_play.png', :alt => 'Play', :class => 'banner' %>
    <p class="point top-point">
      We engage employees in a game that makes getting healthy feel fun.
    </p> 

    <div class="subcolumns">
      <div class="left">
        <p class="point subpoint">
          Do healthy behaviors
        </p>
        <p>Whenever Amy makes a healthy decision she sends a text message.</p>
        <%= image_tag 'new_marketing/play_text1.png', :alt => "She can also play via email or website" %>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_play1.png', :alt => "Amy texts \"ate salad\"" %>
      </div>
    </div>    

    <div class="subcolumns-separator"></div>

    <div class="subcolumns">
      <div class="left">
        <p class="point subpoint">
          Earn points
        </p>
        <p>H Engage responds with immediate positive reinforcement. Amy likes earning points so she makes healthier choices.</p>
        <%= image_tag 'new_marketing/play_text2.png', :alt => "We use game mechanics to make earning points feel fun" %>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_play2.png', :alt => "Amy gets a text back: \"You're on your way to getting five servings of fruits & vegetables a day!\"" %>
      </div>
    </div>

    <div class="subcolumns-separator"></div>

    <div class="subcolumns">
      <div class="left">
        <p class="point subpoint">
          Socialize and compete
        </p>
        <p>Amy's game activity is posted to a private social networking site where players compete and learn new healthy behaviors.</p>
        <%= image_tag 'new_marketing/play_text3.png', :alt => "H Engage adds information about why an activity is healthy right into the posting." %>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_play3.png', :alt => "Posted to the website: \"I ate a salad. To avoid extra calories use oil & vinegar as a great healthy dressing.\"" %>
      </div>
    </div>

    <div class="subcolumns-separator"></div>

  </div>
  <div class="shim">
  </div>

  <a name="engage"></a>

  <div class="main-section">
    <%= image_tag 'new_marketing/h_engage.png', :alt => 'Engage', :class => 'banner' %>
    <p class="point top-point">
      We use the excitement generated by the game to increase employee engagement in your initiatives.
    </p> 

    <div class="subcolumns">
      <div class="left">
        <p class="subpoint">
          More people pay attention<br/> to your communications.
        </p>

        <p>
          They become part of an engaging gaming experience.
        </p>
      </div>

      <div class = "right-text">
        <p class="subpoint">
          More people participate<br/>in your wellness programs.
        </p>

        <p>
          Game-mechanics-based incentives and our social media portal promote participation.
        </p>
      </div>
    </div>
    <%= image_tag 'new_marketing/img_b_engage.png', :alt => 'Points can be linked to any incentives system.' %>
  </div>

  <div class="shim">
  </div>

  <a name="track"></a>
  <div class="main-section">
    <%= image_tag 'new_marketing/h_track.png', :alt => 'Track', :class => 'banner' %>
    <div class="subcolumns">
      <div class="left">
        <p class="point subpoint">
          Track results
        </p>

        <p>
          We provide you with data that help track engagement in your communications and wellness programs, and help you prove ROI.
        </p>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_b_track.png', :alt => 'Checklist' %>
      </div>
    </div>

    <div class="subcolumns-separator"></div>

    <div class="subcolumns">
      <div class="left">
        <p class="point subpoint">
          Gather flash survey data
        </p>

        <p>
          We even provide a text-messaging based survey platform to help you gather employee feedback in real time.
        </p>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_magnify.png', :alt => 'Survey question' %>
      </div>
    </div>  
  </div>

  <div class="shim">
  </div>

  <a name="roi"></a>
  <div class="main-section">
    <%= image_tag "new_marketing/h_roi.png", :alt => 'Return On Investment', :class => 'banner' %>
    <p class="point top-point">
      We provide a measurable ROI in months, not years, by maximizing the return of your existing investments:
    </p> 

    <div class="subcolumns">
      <div class="left">
        <ol>
          <li>Increase participation rates in wellness programs</li>
          <li>Increase engagement in communications</li>
        </ol>
      </div>

      <div class="right">
        <%= image_tag 'new_marketing/img_roi.png', :alt => 'ROI going up' %>
      </div>
    </div>
  </div>

  <div class="shim">
  </div>

  <a name="blog"></a>
  <div class="main-section">
    <%= image_tag 'new_marketing/h_blog.png', :alt => 'Read our blog', :class => 'banner' %>

    <div class="blog-section">
      <p id="blog-name" class="point top">
        <a href="http://hengage.tumblr.com">Under the Node Tree</a>
      </p>
      <p>
        News about H Engage, analysis, and statistics.
      </p>

      <% 3.times do %>
        <%= render 'tumblr_post_target', :post_class => 'recent-post' %>
      <% end %>

    </div>

    <div class="blog-section">
      <p id="blog-name" class="point">
        Facts and Statistics
      </p> 
      <p>
        Meeting coming up? Review recent stats.
      </p>

      <% 7.times do %>
        <%= render 'tumblr_post_target', :post_class => 'stats-post', :suppress_link => true %>
      <% end %>
    </div>
  </div>

  <div class="shim">
  </div>

  <a name="video"></a>
  <div class="main-section">
    <%= image_tag 'new_marketing/h_video.png', :alt => 'Why we created H Engage', :class => 'banner' %>
    <%= image_tag 'new_marketing/fpo2.png', :alt => 'TODO: embed video' %>
  </div>

  <div class="shim">
  </div>
</div>

<div id="request-consultation-bar">
  <a name="contact"></a>
  <form method="post" action="#" class="request-info">
    <span id="request-consultation">
      request a<br/>consultation
    </span>

    <%= text_field_tag "email[name]", 'name', :class => 'with-placeholder fat-text-field' %>

    <%= image_tag 'new_marketing/img_ampersand.png', :alt => 'and' %>

    <%= text_field_tag "email[email]", 'email', :class => 'with-placeholder fat-text-field' %>
    <%= image_submit_tag 'new_marketing/btn_submit.png' %><br/>

  </form>
</div>

<% content_for :page_footer do %>
  <div id="marketing-footer-wrapper">
    <div id="marketing-footer">
      <div id="sm-buttons">
        <a href="#"><%= image_tag 'new_marketing/img_email.png', :alt => 'Email' %> <span class="sm-action">email H Engage</span></a><br/>
        <!-- TODO: Do we even have a Facebook account? <a href='#'><%= image_tag 'new_marketing/img_fb.png', :alt => 'Facebook' %> <span class="sm-action">like H Engage</span></a> <br/>-->
        <a href="http://twitter.com/hengage"><%= image_tag 'new_marketing/img_twitter.png', :alt => 'Twitter' %> <span class="sm-action">follow H Engage</span> </a><br/>
        <a href="http://twitter.com/hengage"><%= image_tag 'new_marketing/img_tumblr.png', :alt => 'Tumblr' %> <span class="sm-action">subscribe to H Engage</span></a>
      </div>

      <div id="about-us">
        <p class="title">
          H Engage is a wellness engagement platform.
        </p>
        <p>
          We spark excitement in health, make corporate communications interactive, and increase participation in wellness programs using a fun mobile game that drives ROI.
        </p>
      </div>

      <div class="clear">&nbsp;</div>
    </div>
  </div>
<% end %>

<% content_for :javascript do %>
  <%= javascript_tag do %>
    function bodyExcerpt(body) {
      var words = body.split(/\s+/);
      return words.slice(0, 30).join(' ') + '...';
    }

    function populatePost(postElement, title, body, url) {
      $(postElement).
        find('.title a').
          text(title).
          attr('href', url).
          end().
        find('.body').
          text(body).
          end().
        find('a.read-more').
          attr('href', url);
    }

    function populateRecentPosts(tumblrData) {
      postElements = $('.recent-post');
      $.each(tumblrData.posts, function(index, post) {
        populatePost(postElements[index], post['regular-title'], bodyExcerpt(post['regular-body']), post['url']);
      });
    }

    function populateStatsPosts(tumblrData) {
      postElements = $('.stats-post');
      $.each(tumblrData.posts, function(index, post) {
        populatePost(postElements[index], '', post['quote-text'], '');
      });
    }
  <% end %>

  <script src="http://hengage.tumblr.com/api/read/json?start=0&num=3&filter=text&type=text&callback=populateRecentPosts"></script>

  <script src="http://hengage.tumblr.com/api/read/json?start=0&num=3&filter=text&tagged=stats&type=quote&callback=populateStatsPosts"></script>

  <%= javascript_tag do %>
    function makePostitJiggle(elementId, originalPath, hoverPath) {
      $('#' + elementId).
        mouseover(function(e) {$(this).attr('src', hoverPath)}).
        mouseout(function(e) {$(this).attr('src', originalPath)});
    }

    function requestInfoBeforePost(form) {
      form.find('input').attr('disabled', 'disabled');
    }

    function requestInfoAfterPost(form) {
      form.html('<span class="thanks-message">Thanks, we\'ll be in touch.</span>');
    }

    function addRequestFormCallbacks(selector, beforePost, afterPost) {
      $(selector).submit(function(e) {
        e.preventDefault();

        var submitForm = $(this);
        var formValues = submitForm.serialize();

        beforePost(submitForm);

        $.post(
          '<%= email_info_requests_path %>',
          formValues,
          function() {afterPost(submitForm)}
        )
      });
    }

    addRequestFormCallbacks('.request-info', requestInfoBeforePost, requestInfoAfterPost);

    // reloads on Firefox are stupid
    $('.request-info input').removeAttr('disabled');

    var loginForm = $('#login-form');

    $('#activate-login-form').submit(function(e) {
      e.preventDefault();
      $('#login-form').toggle();
    });
  <% end %>
<% end %>
