<% [
  %w(new_messages new_message),
  %w(watch_listed_messages watch_listed_message),
  %w(all_messages generic_message)
].each do |message_type, partial_name| %> 

  <% messages = instance_variable_get("@#{message_type}") %>
  <% message_div_selector = "##{message_type.dasherize} .messages" %>

  <% messages.each do |message| %>
    <% message_content = escape_javascript(render partial_name, :message => message) %>
    var messageContent = '<%=  message_content %>';
    $('<%= message_div_selector %>').prepend(messageContent);
  <% end %>
<% end %>



<% @all_messages.each do |message| %>
  collapse($('#<%= dom_id(message) %>'));
  collapse($('#generic_<%= dom_id(message) %>'));
<% end %>

<%= render 'shared/yield_stripped_javascript' %>

updateNewMessageCount();
updateWatchlistedMessageCount();
updateAllMessageCount();

newestMessageId = <%= @newest_message_id %>;
scheduleMessagePoll();
