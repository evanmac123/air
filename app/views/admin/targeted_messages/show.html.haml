= stylesheet_link_tag "admin/targeted_messages"

= render 'shared/segmentation_results', segmentation_results: @segmentation_results 

= render 'shared/segmentation_form', :dummy_characteristics => @dummy_characteristics, :generic_characteristics => @generic_characteristics, :demo_specific_characteristics => @demo_specific_characteristics, :demo => @demo 

= render 'shared/show_user_links' 

= form_tag admin_demo_targeted_messages_path(@demo), :id => 'message-content' do
  %fieldset
    %legend Email
    #subject-wrapper
      = label_tag :subject
      = text_field_tag "subject", @subject

    #html-text-wrapper
      = label_tag :html_text, "HTML text"
      = text_area_tag "html_text", @html_text, :rows => 20, :cols => 100, :class => "tinymce"

    #plain-text-wrapper
      = label_tag :plain_text
      = text_area_tag "plain_text", @plain_text, :rows => 20, :cols => 147

  %fieldset
    %legend SMS
    = label_tag :sms_text
    = text_field_tag "sms_text", @sms_text, :maxlength => 160, :size => 165
    = add_byte_counter_for "Sms text"

  %br
  = label_tag "respect_notification_method"
  = check_box_tag "respect_notification_method", "1", true
  %br
  = submit_tag "DO IT"

- unless Rails.env.test?
  -# This is not done through the asset pipeline since that leads to problems
  -# with inter-iframe communication when we load other TinyMCE windows such
  -# as the image insert dialog
  = javascript_include_tag "/tinymce/jscripts/tiny_mce/tiny_mce.js"
  :javascript
    tinyMCE.init({
      mode: "exact",
      elements: "html_text"
    });
