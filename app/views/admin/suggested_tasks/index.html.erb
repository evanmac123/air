<% if @suggested_tasks.empty? %>
  <p>No suggested tasks for this demo.</p>
<% else %>
  <table>
    <tr>
      <th>Name</th>
      <th>Short description</th>
      <th>Long description</th>
      <th>Eligibility conditions</th>
      <th>Completion triggers</th>
      <th>Bonus points</th>
      <th></th>
    </tr>

    <% @suggested_tasks.each do |suggested_task| %>
      <tr>
        <td><%= suggested_task.name %></td>
        <td><%= suggested_task.short_description %></td>
        <td><%= suggested_task.long_description %></td>
        <td>
          <% if suggested_task.start_time %>
            <p>Start time: <%= suggested_task.start_time.pretty %></p>
          <% end %>

          <% if suggested_task.prerequisite_tasks.present? %>
            <% prerequisite_names = suggested_task.prerequisite_tasks.map(&:name).sort %>
            Prerequisites:
            <ul>
              <% prerequisite_names.each do |prerequisite_name| %>
                <li><%= prerequisite_name %></li>
              <% end %>
            </ul>
          <% end %>
        </td>
        <td>
          <% if suggested_task.rule_triggers.present? %>
            <p>Rules (any of the following<%= ", referrer required" if suggested_task.rule_triggers.first.referrer_required%>):
              <ul>
                <% suggested_task.rule_triggers.each do |rule_trigger| %>
                  <li><%= rule_trigger.rule.primary_value_text %></li>
                <% end %>
              </ul>
            </p>
          <% end %>

          <% if suggested_task.survey_trigger.present? %>
            <p>Survey: <%= suggested_task.survey_trigger.survey.name %></p>
          <% end %>

          <% if suggested_task.rule_triggers.empty? && suggested_task.survey_trigger.blank? %>
            <p>Manual only.</p>
          <% end %>
        </td>
        <td><%= suggested_task.bonus_points %></td>
        <td>
          <%= link_to 'Edit this task', edit_admin_demo_suggested_task_path(@demo, suggested_task) %>
        </td>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>

<p><%= link_to "Add suggested task", new_admin_demo_suggested_task_path(@demo) %></p>
