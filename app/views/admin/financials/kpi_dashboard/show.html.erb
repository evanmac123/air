
<div class="row">
  <div class="columns small-12 small-centered">
    <p>
    <h1>Financials KPI Dashboard</h1>
    </p>
    <%=form_tag admin_metrics_path, method: :get do %>
      <table>
        <caption>Reporting Period</caption>
        <thead>
          <tr>
            <th>Start</th>
            <th>End</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%=text_field_tag "sdate", @sdate, type: :date%></td>
            <td><%=text_field_tag "edate",@edate, type: :date%></td>
            <td><%=submit_tag "Get Data", class:"button td-button right"%></td>

          </tr>
        </tbody>
      </table>

      <div id="container" style="width:100%; height:400px;" data-plotdata ="<%=@plot_data.to_json%>"></div>
  </div>
</div>

<div class="row ">
  <div class="large-12 columns">
    <table>
      <thead>
      </thead>
      <tbody>
        <%if ! @kpi.nil?%>
          <%Metrics.field_mapping.each do |header,field|%>
            <tr>
              <th><%=header[0]%></th>
              <%@kpi.each do |h| %>
                <td><%=simple_format_by_type header[1], h[field]%></td>
              <%end%>
            </tr>
          <%end%>
        <%end%>
      </tbody>
    </table>

    <%=link_to "Download CSV", admin_metrics_path(sdate:@sdate, edate: @edate, format: :csv),  class:"button right"%>
  <%end%>
  </div>
</div>

<script>
$(function () { 
  var myChart = Highcharts.chart('container', {
    chart: {
      type: 'line'
    },
    title: {
      text: 'Monthly Recuring Revenue'
    },
    xAxis: x_axis_params() ,
    yAxis: y_axis_params(),
    series: [{
      data: $("#container").data("plotdata")
    } ]
  });
});


function legend_params(){
  return { enabled: false };
} 

function x_axis_params(){
   return   {
        title: {
          text: "" 
        },
        type: 'datetime',
        lineWidth: 0,
        dateTimeLabelFormats: {
          day: "%b %d",
          week: "%b %d",
          month: '%b %Y',
          year: '%Y'
        },
        offset: 10,
        labels: {
          align: 'center',
          style: {
            color: '#a8a8a8',
            'font-weight':  700
          },
          useHTML: true
        },
        tickColor: 'white',
        maxPadding: 0.04,
        minPadding: 0.04
      }
}

function y_axis_params (){
  return  {
    allowDecimals: false,
    gridLineColor: '#d6d6d6',
    offset: 7,
    labels: {
      style: {
        color: '#a8a8a8',
        'font-weight':  700
      },
      useHTML: true
    },
    title: {
      text: ""
    },
    min: 0,
    tickPixelInterval: 47
  }

}
</script>


