<% overlay_displayed ||= false %>
<% show_copy_button ||= false %>
<% is_preview ||= false %>
<% is_manage ||= false %>
<% tile = FullSizeTilePresenter.new(tile, current_user, is_preview, @current_tile_ids, browser) %>

<div class="tile_holder <%= tile.creator_class %>"
  data-current-tile-id="<%= tile.id %>"
  data-completed-only="<%= @show_completed_tiles %>"
  data-show-conversion-form="<%= @show_conversion_form||false %>"
  data-show-start-over="<%= session[:display_start_over_button] %>"
  data-current-tile-ids="<%= tile.current_tile_ids_joined %>"
  >

  <div class="<%=tile_class(tile)%>">
    <div class="tile_full_image <%= is_manage ? 'loading' : '' %>" style="<%= tile.image_styles %>"  data-intro="Hi, this walkthrough helps you understand the anatomy of a tile. </br>All tiles have an image which is a powerful way to get your viewer's attention." data-position="top" data-step=1>
      <%= image_tag tile.image.url, :class => :tile_image, :alt => tile.headline, id:"tile_img_preview" %>
      <div class="shadow_overlay"></div>
      <div class="image_credit">
        <div class="image_credit_view">
          <%= link_to_if is_url?(tile.image_credit), truncate(tile.image_credit, length: 50), make_full_url(tile.image_credit), target: "_blank" %>
        </div>
      </div>
    </div>
    <!-- FIXME do we need this appears_client_created. what the heck is that? -->
    <% if tile.appears_client_created %>
      <div class="tile_texts_container" data-step=2 data-intro="The Headline provides a quick overview of what a Tile is about. The Supporting Content section is where you fill in the core information you wish to share. There is a 750 character limit but you can always insert a link to documents on the web or your intranet if the 750 characters is not enough.">
        <div class="tile_headline content_sections"><%= tile.headline %></div>
        <div class="tile_supporting_content content_sections <%= tile.custom_supporting_content_class %>">
          <%= unescape_html(tile.supporting_content) %>
        </div>
        <% if tile.link_address.present? %>
          <div class="tile_external_link content_sections">
            Visit <%= link_to truncate(tile.link_address, length: 30), tile.link_address, target: '_blank' %> <%= link_to fa_icon("external-link"), tile.link_address, target: '_blank' %>
          </div>
        <% end %>
      </div>

      <div class="tile_quiz" data-intro="The Interaction section is where you engage your viewers with a short question which you'd like them to answer. The response type Interaction supports various formats from simple one button confirmation, to a quizes, multiple choice,  and Surveys. Finally, you can assign a number of points to each Tile which employees earn as they complete the Tile interactions. Use the point totals to setup incentive rewards for employees who engage with your content. Airbo tracks both who has viewed a Tile and completed the interaction automatically so you don't have to.">         <% if tile.points %>
            <div class="tile_points_bar">
              <div class="earnable_points">
                <span class="num_of_points" id="tile_point_value"><%= tile.points %></span>
                <span class="points_label"><%= tile.points > 1 ? "Points" : "Point" %></span>
              </div>
            </div>
          <% end %>


          <div class="tile_question content_sections"><%= tile.question %></div>
          <%= render 'tiles/multiple_choice_answers', tile: tile %>
        </div>
    <% end %>

    <% overlay_style = overlay_displayed ? "display:block" : "" %>
    <div id="spinner_large" style="<%= overlay_style %>">
    </div>
  </div>
</div>

<%= render 'tiles/copy_button', tile: tile if show_copy_button%>

<% tile.adjacent_tile_image_urls.each do |adjacent_tile_image_url| %>
  <%= javascript_tag do %>
    $(document).ready(function() { preflight("<%= adjacent_tile_image_url %>"); });
  <% end %>
<% end %>
