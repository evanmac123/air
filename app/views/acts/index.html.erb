<%= javascript_include_tag 'jquery.lightbox_me' %>
<%= render partial: 'shared/tiles/user_progress', locals: {raffle: current_user.demo.raffle} %>
<%= render 'shared/tile_wall', @displayable_categorized_tiles.merge(path_for_more_tiles: tiles_path) %>

<div class="row">
  <div id="feed_wrapper" class="large-4 columns">
    <div class="feeds module">

      <h3 id="feeds_title">Activity</h3>

  	    <% content_for :javascript do %>
          <%= javascript_tag do %>
            bindShowMoreTilesLink('.show_more_tiles', '.tile-wrapper', '#show_more_tiles_spinner', '#tile_wall', 'replace');
          <% end %>
  	    <% end %>

        <ul id="user-acts">
  	      <%= render :partial => "shared/act", :collection => @acts, :as => :act %>
        </ul>

        <%= render 'shared/see_more' %>

        <%= image_tag 'spinner_gears.gif', :id => 'see-more-spinner', :style => 'display:none;' %>

  	    <%= render 'shared/bind_see_more', 
  	      :offset_var_name     => 'actOffset', 
  	      :current_offset      => @acts.length,
  	      :button_selector     => '#see-more',
  	      :spinner_selector    => '#see-more-spinner',
  	      :original_path       => acts_path(:format => :js, :show_only => @show_only, :mode => 'see-more'),
  	      :path_var_name       => 'actsPath',
  	      :mixpanel_event_name => 'saw more acts'
  	    %>

  	</div>
  </div>

  <div class="large-4 columns">
    <div class="module" id="scoreboard-module">
      <%= render 'scoreboard', :user => @current_user %>
    </div>
  </div>

  <div class="large-4 columns">
    <div class="module" id="invite-module">
      <%= render(:partial => "invite_your_friends") unless @current_user.is_guest? %>  
    </div>
  </div>

</div>

<%= render "shared/guest_conversion_lightbox", user: @current_user, show_conversion_form: @show_conversion_form, demo: @current_user.demo %>

<% if current_user.is_a? PotentialUser %>
  <div id="register_potential_user_lightbox" class="start_lightbox">
    <h3>Welcome to the <%= current_user.demo.name%>!</h3>
    <%= form_tag potential_user_conversions_path do %>
      <%= label_tag "potential_user_name", "Enter your first and last name to continue:" %>
      <%= text_field_tag "potential_user_name" %>
      <% hidden_field_tag "potential_user_id", current_user.id %>
      <%= submit_tag "Next", disabled: true %>
    <% end %>
  </div>

  <% content_for :javascript do %>
    <%= javascript_tag do %>
      $('#register_potential_user_lightbox').lightbox_me({closeClick: false});
      $("#potential_user_name").on('input propertychange paste', function() {
        submit_button = $("#register_potential_user_lightbox input[type='submit']")
        if( $(this).val().match(/\w+\s+\w+/) ){
          submit_button.removeAttr("disabled")
        }else{
          submit_button.attr("disabled", "disabled")
        }
      });
    <% end %>
  <% end %>
<% elsif @display_activity_page_admin_guide %>
  <div id ='activity-joyride'>
    <ol class='joyride-list activity-index' data-joyride>
      <li data-id='manage_board' data-options='tipLocation:bottom' data-text='Got It'>
          <p class='top-section'>
          To return to the tile manager click <span>Manage</span>.
        </p>
      </li>
    </ol>
  </div>
<% elsif @display_get_started_lightbox %>
  <% lightbox_class = @current_user.is_guest? ? 'for_guest' : '' %>
  <div id='get_started_lightbox' class="<%= lightbox_class %> start_lightbox">
    <a href="#" id="close_get_started_lightbox">Get started!</a>
    <h3>Welcome to the <%= current_user.demo.name%>!</h3>
    <p>Airbo is an interactive communication tool. Get started by clicking on a tile. Interact and answer questions to earn points. 
    <% if @current_user.is_guest? %>
      <p>Already a user? <%= link_to "Sign in", new_session_path %>.</p>
    <% end %>
  </div>

  <% content_for :javascript do %>
    <%= javascript_tag do %>
      $('#close_get_started_lightbox').click(function(event) {
        event.preventDefault();
        $('#get_started_lightbox').trigger('close');
      });

      $('#get_started_lightbox').lightbox_me({
        onClose: function(){ 
          if( window.showRaffleAfterLightbox == true ){
            showRaffleBox("New Raffle!");
            prizeModalPing("Saw Prize Modal");
          } 
        }
      });
    <% end %>
  <% end %>
<% end %>      
      
